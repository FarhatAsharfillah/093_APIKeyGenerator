<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>

<style>
    body {
        margin: 0;
        background: #0d1117;
        color: #c9d1d9;
        font-family: "Inter", sans-serif;
    }

    .container {
        width: 520px;
        margin: 60px auto;
        background: #161b22;
        padding: 30px;
        border-radius: 14px;
        box-shadow: 0 0 25px rgba(88,166,255,0.25);
    }

    h2 {
        text-align: center;
        color: #58a6ff;
        margin-bottom: 22px;
    }

    button {
        width: 100%;
        padding: 12px;
        margin-top: 10px;
        background: #1f6feb;
        border: none;
        border-radius: 6px;
        color: white;
        cursor: pointer;
        font-size: 15px;
        font-weight: 600;
    }

    button:hover { background: #388bfd; }

    .result {
        margin-top: 20px;
        padding: 15px;
        border-radius: 8px;
        background: #0d1117;
        border: 1px solid #30363d;
    }

    .alert-error {
        color: #ff7b72;
        background: rgba(248,81,73,0.15);
        border: 1px solid #da3633;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        background: #0d1117;
        border: 1px solid #30363d;
    }
    th, td {
        padding: 10px;
        border: 1px solid #30363d;
        font-size: 13px;
    }
    th {
        background: #161b22;
        color: #58a6ff;
        font-weight: 600;
    }

    .status-active {
        color: #3fb950;
        font-weight: bold;
    }
    .status-inactive {
        color: #ff7b72;
        font-weight: bold;
    }

    #loading {
        text-align: center;
        margin-top: 15px;
        display: none;
        color: #58a6ff;
    }
</style>
</head>

<body>

<script>
/* =============================
   CEK APAKAH ADMIN SUDAH LOGIN
   ============================= */
if (localStorage.getItem("role") !== "admin") {
    window.location.href = "index.html";
}
</script>

<!-- ====================== DASHBOARD ====================== -->
<div class="container" id="adminDashboard">
    <h2>APIKey Dashboard</h2>

    <button onclick="loadUsers()">Refresh User List</button>

    <div id="loading">Loading user data...</div>

    <div class="result" id="userList"></div>
</div>

<script>
/* =============================
   LOAD USERS FROM SERVER
   ============================= */
async function loadUsers(){
    userList.innerHTML = "";
    loading.style.display = "block";

    const res = await fetch("/admin/view-users");
    const data = await res.json();

    loading.style.display = "none";

    console.log(data);

    // Error handling
    if (!res.ok || !data) {
        userList.innerHTML = `
            <div class="alert-error">❌ Failed to load user data</div>
        `;
        return;
    }

    // Dari admin.js → router.get("/view-users") mengirim rows langsung
    const users = Array.isArray(data) ? data : data.users;

    if (!data.users || data.users.length === 0) {

        userList.innerHTML = "<p>No users found.</p>";
        return;
    }

    // Build table
    let html = `
        <table>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>API Key Hash</th>
                <th>Status</th>
                <th>Expired</th>
            </tr>
    `;

    users.forEach(u => {
        html += `
            <tr>
                <td>${(u.firstname || "") + " " + (u.lastname || "")}</td>
                <td>${u.email}</td>
                <td>${u.apikey_hash || "-"}</td>
                <td class="${u.status === 'active' ? 'status-active' : 'status-inactive'}">
                    ${u.status || "-"}
                </td>
                <td>${u.expired_at ? new Date(u.expired_at).toLocaleDateString() : "-"}</td>
            </tr>
        `;
    });

    html += "</table>";

    userList.innerHTML = html;
}

// Auto load on page load
loadUsers();
</script>

</body>
</html>
